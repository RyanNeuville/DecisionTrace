generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  passwordHash String?  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  decisions    Decision[]
  transactions Transaction[]
}

model Decision {
  id            String   @id @default(cuid())
  title         String
  context       String  
  responsible   String   
  status        String   @default("draft") /** draft, in_progress, validated, rejected, archived */
  justification String?  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  options       Option[]
  criteria      Criteria[]

  @@index([userId])
}

model Option {
  id          String @id @default(cuid())
  name        String
  description String?

  decisionId  String
  decision    Decision @relation(fields: [decisionId], references: [id], onDelete: Cascade)

  evaluations Evaluation[]

  @@index([decisionId])
}

model Criteria {
  id     String @id @default(cuid())
  name   String
  weight Int    @default(5) /** ponderation de 1 a 10 */

  decisionId String
  decision   Decision @relation(fields: [decisionId], references: [id], onDelete: Cascade)

  evaluations Evaluation[]

  @@index([decisionId])
}

model Evaluation {
  id         String @id @default(cuid())
  score      Int    /** note de 1 a 10 */

  optionId   String
  option     Option   @relation(fields: [optionId], references: [id], onDelete: Cascade)

  criteriaId String
  criteria   Criteria @relation(fields: [criteriaId], references: [id], onDelete: Cascade)

  @@unique([optionId, criteriaId]) // une seule évaluation par option/critère
  @@index([optionId])
  @@index([criteriaId])
}

model Transaction {
  id          String   @id @default(cuid())
  type        String   /** entry ou exit */
  amount      Decimal  /** SQLite gère Decimal via string, mais Prisma le convertit bien */
  category    String
  description String?
  date        DateTime @default(now())

  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([date])
  @@index([type])
}